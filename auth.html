<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>URSA Auth</title>
  <style>
    :root {
      --accent: #00eaff;
      --bg: #000;
      --glow: 0 0 12px var(--accent), 0 0 24px var(--accent);
    }

    body {
      background: var(--bg);
      color: var(--accent);
      font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      text-align: center;
      animation: fadeIn 1s ease;
    }

    #status {
      font-size: 17px;
      opacity: 0.9;
      margin-bottom: 24px;
      line-height: 1.4;
      text-shadow: var(--glow);
      transition: all 0.3s ease;
      max-width: 90%;
    }

    .btn {
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 14px;
      padding: 13px 28px;
      font-size: 17px;
      font-weight: 600;
      margin: 8px 0;
      cursor: pointer;
      box-shadow: 0 0 12px var(--accent);
      transition: all 0.25s ease;
      width: 80%;
      max-width: 280px;
    }
    .btn:hover {
      transform: scale(1.03);
      box-shadow: 0 0 18px var(--accent), 0 0 36px var(--accent);
    }
    .btn:active {
      transform: scale(0.97);
      opacity: 0.8;
    }

    #open { display: none; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="status">üîê –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...</div>
  <button id="go" class="btn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
  <button id="open" class="btn">–û—Ç–∫—Ä—ã—Ç—å URSA –≤—Ä—É—á–Ω—É—é</button>

  <script type="module">
    import { auth } from "./assets/js/firebase.js";
    import {
      GoogleAuthProvider,
      signInWithRedirect,
      signInWithPopup,
      getRedirectResult
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    const status = (msg) => document.getElementById("status").innerText = msg;
    const goBtn = document.getElementById("go");
    const openBtn = document.getElementById("open");
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({ prompt: "select_account" });

    // === –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ redirect ===
    (async () => {
      const res = await getRedirectResult(auth);
      if (res?.user) {
        const token = await res.user.getIdToken();
        status("‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! –û—Ç–∫—Ä—ã–≤–∞–µ–º URSA...");
        try {
          const w = window.open("https://ursaipa.live/?token=" + encodeURIComponent(token), "_blank");
          if (!w) {
            status("‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! Safari –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ URSA.");
            openBtn.style.display = "block";
            openBtn.onclick = () => window.location.href = "https://ursaipa.live/?token=" + encodeURIComponent(token);
          }
        } catch {
          openBtn.style.display = "block";
          openBtn.onclick = () => window.location.href = "https://ursaipa.live/?token=" + encodeURIComponent(token);
        }
        return;
      }
    })();

    // === –í—Ö–æ–¥ —á–µ—Ä–µ–∑ popup ===
    goBtn.onclick = async () => {
      try {
        status("üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ Google...");
        const res = await signInWithPopup(auth, provider);
        if (res?.user) {
          const token = await res.user.getIdToken();
          status("‚úÖ –ü–æ–ø-–∞–ø –≤—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! –û—Ç–∫—Ä—ã–≤–∞–µ–º URSA...");
          try {
            const w = window.open("https://ursaipa.live/?token=" + encodeURIComponent(token), "_blank");
            if (!w) {
              status("‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! Safari –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –æ—Ç–∫—Ä—ã—Ç–∏–µ URSA.");
              openBtn.style.display = "block";
              openBtn.onclick = () => window.location.href = "https://ursaipa.live/?token=" + encodeURIComponent(token);
            }
          } catch {
            openBtn.style.display = "block";
            openBtn.onclick = () => window.location.href = "https://ursaipa.live/?token=" + encodeURIComponent(token);
          }
        } else throw new Error("Popup –Ω–µ –≤–µ—Ä–Ω—É–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
      } catch (e) {
        console.warn("Popup –≤—Ö–æ–¥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:", e);
        status("‚Ü™Ô∏è Popup –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Safari. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...");
        await signInWithRedirect(auth, provider);
      }
    };
  </script>
</body>
</html>
